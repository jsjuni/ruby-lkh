# frozen_string_literal: true

require 'minitest/autorun'
require 'tsplib'

TSP_INFO = '
NAME: gr17
TYPE: TSP
COMMENT: 17-city problem (Groetschel)
DIMENSION: 17
EDGE_WEIGHT_TYPE: EXPLICIT
EDGE_WEIGHT_FORMAT: LOWER_DIAG_ROW
EDGE_WEIGHT_SECTION
'.strip + "\n"

TSP_WEIGHTS_TEXT = '    ' + '
    0
  633    0
  257  390    0
   91  661  228    0
  412  227  169  383    0
  150  488  112  120  267    0
   80  572  196   77  351   63    0
  134  530  154  105  309   34   29    0
  259  555  372  175  338  264  232  249    0
  505  289  262  476  196  360  444  402  495    0
  353  282  110  324   61  208  292  250  352  154    0
  324  638  437  240  421  329  297  314   95  578  435    0
   70  567  191   27  346   83   47   68  189  439  287  254    0
  211  466   74  182  243  105  150  108  326  336  184  391  145    0
  268  420   53  239  199  123  207  165  383  240  140  448  202   57    0
  246  745  472  237  528  364  332  349  202  685  542  157  289  426  483    0
  121  518  142   84  297   35   29   36  236  390  238  301   55   96  153  336    0
'.strip

TSP_WEIGHTS = [
  [    0],
  [  633,    0],
  [  257,  390,    0],
  [   91,  661,  228,    0],
  [  412,  227,  169,  383,    0],
  [  150,  488,  112,  120,  267,    0],
  [   80,  572,  196,   77,  351,   63,    0],
  [  134,  530,  154,  105,  309,   34,   29,    0],
  [  259,  555,  372,  175,  338,  264,  232,  249,    0],
  [  505,  289,  262,  476,  196,  360,  444,  402,  495,    0],
  [  353,  282,  110,  324,   61,  208,  292,  250,  352,  154,    0],
  [  324,  638,  437,  240,  421,  329,  297,  314,   95,  578,  435,    0],
  [   70,  567,  191,   27,  346,   83,   47,   68,  189,  439,  287,  254,    0],
  [  211,  466,   74,  182,  243,  105,  150,  108,  326,  336,  184,  391,  145,    0],
  [  268,  420,   53,  239,  199,  123,  207,  165,  383,  240,  140,  448,  202,   57,    0],
  [  246,  745,  472,  237,  528,  364,  332,  349,  202,  685,  542,  157,  289,  426,  483,    0],
  [  121,  518,  142,   84,  297,   35,   29,   36,  236,  390,  238,  301,   55,   96,  153,  336,    0]
]

ATSP_INFO = '
NAME: br17
TYPE: ATSP
COMMENT: 17 city problem (Repetto)
DIMENSION: 17
EDGE_WEIGHT_TYPE: EXPLICIT
EDGE_WEIGHT_FORMAT: FULL_MATRIX
EDGE_WEIGHT_SECTION
'.strip + "\n"

ATSP_WEIGHTS_TEXT = ' ' + '
 9999    3    5   48   48    8    8    5    5    3    3    0    3    5    8    8    5
    3 9999    3   48   48    8    8    5    5    0    0    3    0    3    8    8    5
    5    3 9999   72   72   48   48   24   24    3    3    5    3    0   48   48   24
   48   48   74 9999    0    6    6   12   12   48   48   48   48   74    6    6   12
   48   48   74    0 9999    6    6   12   12   48   48   48   48   74    6    6   12
    8    8   50    6    6 9999    0    8    8    8    8    8    8   50    0    0    8
    8    8   50    6    6    0 9999    8    8    8    8    8    8   50    0    0    8
    5    5   26   12   12    8    8 9999    0    5    5    5    5   26    8    8    0
    5    5   26   12   12    8    8    0 9999    5    5    5    5   26    8    8    0
    3    0    3   48   48    8    8    5    5 9999    0    3    0    3    8    8    5
    3    0    3   48   48    8    8    5    5    0 9999    3    0    3    8    8    5
    0    3    5   48   48    8    8    5    5    3    3 9999    3    5    8    8    5
    3    0    3   48   48    8    8    5    5    0    0    3 9999    3    8    8    5
    5    3    0   72   72   48   48   24   24    3    3    5    3 9999   48   48   24
    8    8   50    6    6    0    0    8    8    8    8    8    8   50 9999    0    8
    8    8   50    6    6    0    0    8    8    8    8    8    8   50    0 9999    8
    5    5   26   12   12    8    8    0    0    5    5    5    5   26    8    8 9999
'.strip

ATSP_WEIGHTS = [
  [ 9999,    3,    5,   48,   48,    8,    8,    5,    5,    3,    3,    0,    3,    5,    8,    8,    5],
  [    3, 9999,    3,   48,   48,    8,    8,    5,    5,    0,    0,    3,    0,    3,    8,    8,    5],
  [    5,    3, 9999,   72,   72,   48,   48,   24,   24,    3,    3,    5,    3,    0,   48,   48,   24],
  [   48,   48,   74, 9999,    0,    6,    6,   12,   12,   48,   48,   48,   48,   74,    6,    6,   12],
  [   48,   48,   74,    0, 9999,    6,    6,   12,   12,   48,   48,   48,   48,   74,    6,    6,   12],
  [    8,    8,   50,    6,    6, 9999,    0,    8,    8,    8,    8,    8,    8,   50,    0,    0,    8],
  [    8,    8,   50,    6,    6,    0, 9999,    8,    8,    8,    8,    8,    8,   50,    0,    0,    8],
  [    5,    5,   26,   12,   12,    8,    8, 9999,    0,    5,    5,    5,    5,   26,    8,    8,    0],
  [    5,    5,   26,   12,   12,    8,    8,    0, 9999,    5,    5,    5,    5,   26,    8,    8,    0],
  [    3,    0,    3,   48,   48,    8,    8,    5,    5, 9999,    0,    3,    0,    3,    8,    8,    5],
  [    3,    0,    3,   48,   48,    8,    8,    5,    5,    0, 9999,    3,    0,    3,    8,    8,    5],
  [    0,    3,    5,   48,   48,    8,    8,    5,    5,    3,    3, 9999,    3,    5,    8,    8,    5],
  [    3,    0,    3,   48,   48,    8,    8,    5,    5,    0,    0,    3, 9999,    3,    8,    8,    5],
  [    5,    3,    0,   72,   72,   48,   48,   24,   24,    3,    3,    5,    3, 9999,   48,   48,   24],
  [    8,    8,   50,    6,    6,    0,    0,    8,    8,    8,    8,    8,    8,   50, 9999,    0,    8],
  [    8,    8,   50,    6,    6,    0,    0,    8,    8,    8,    8,    8,    8,   50,    0, 9999,    8],
  [    5,    5,   26,   12,   12,    8,    8,    0,    0,    5,    5,    5,    5,   26,    8,    8, 9999]
]

EOF = 'EOF'

class TestTsplib < Minitest::Test

  def test_tsp

    tsp = TSPLIB::TSP.new('gr17', '17-city problem (Groetschel)', 17)
    0.upto(16) do |i|
      0.upto(i) do |j|
        tsp.weight[i][j] = TSP_WEIGHTS[i][j]
      end
    end
    assert_kind_of(TSPLIB::TSP, tsp)
    assert_kind_of(TSPLIB::Problem, tsp)
    input = TSP_INFO + TSP_WEIGHTS_TEXT + EOF
    result = tsp.to_s
    assert_equal(result, input)

  end

  def test_atsp

    atsp = TSPLIB::ATSP.new('br17', '17 city problem (Repetto)', 17)
    ATSP_WEIGHTS.each_index do |i|
      ATSP_WEIGHTS[i].each_index do |j|
        atsp.weight[i][j] = ATSP_WEIGHTS[i][j]
      end
    end
    assert_kind_of(TSPLIB::ATSP, atsp)
    assert_kind_of(TSPLIB::Problem, atsp)
    input = ATSP_INFO + ATSP_WEIGHTS_TEXT + EOF
    result = atsp.to_s
    assert_equal(result, input)
  end

end